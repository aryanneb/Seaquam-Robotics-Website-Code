<!DOCTYPE html>
<html>
<head>
<title>VEX DB Integration</title>

<script>
/*
* VEX DB Integration with HTML and JS
* Author: Mr. Singbeil
*
* This HTML sample shows how to use simple HTTP requests to talk to VEX DB's API and request information about teams.
* The page needs to run off a webserver to facilitate the request correctly:
* https://developer.mozilla.org/en-US/docs/Learn/Common_questions/set_up_a_local_testing_server
*
*/
function searchTeam(){
	var teamName = document.getElementById("teams").options[document.getElementById("teams").selectedIndex].text;
	document.getElementById("team-name").innerHTML = "Please wait...";

	getTeamAwards(teamName).then(function(response) {
		var list = "";
		for (i = 0; i < response.length; i++) {
			list += "<li>" + response[i] + "</li>";
		}
		document.getElementById("team-name").innerHTML = teamName;
		document.getElementById("list").innerHTML = list;
	});
	return;
}

// Returns a list of formatted awards for a given team (type string)
async function getTeamAwards(name) {
	var awardsurl = 'https://api.vexdb.io/v1/get_awards?team='+name;

	var awards = await (await fetch(awardsurl)).json();
	var reqlist = [];
	var ret = [];
	for (i = 0; i < awards.size; i++) {
		let eventurl = "https://api.vexdb.io/v1/get_events?sku="+awards.result[i].sku;
		reqlist.push(fetch(eventurl));
	}
	for (i = 0; i < reqlist.length; i++)
		ret.push((awards.result[i].name + " - " + (await (await reqlist[i]).json()).result[0].name).trim());
	return ret;
}

</script>

</head>
<body>

<h1>VEX DB</h1>
<p>Select a team from the list to view their data</p>

<select name="robo-teams" id="teams">
  <option>9181A</option>
	<option>9181B</option>
	<option>9181C</option>
	<option>9181D</option>
	<option>9181G</option>
	<option>9181J</option>
	<option>9181K</option>
	<option>9181S</option>
	<option>9181T</option>
	<option>9181W</option>
	<option>9181X</option>
	<option>9181Y</option>
  <option>9181Z</option>
</select>

<button onclick="searchTeam()">Search</button>

<div id="results">
	<h1 id="team-name">Please select a team</h1>
	<ul id="list">
	</ul>
</div>

</body>
</html>
